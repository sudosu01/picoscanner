<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>PICO APK Scanner - Smart Real-Time Analysis</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }

        .panel {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        h1, h2, h3 {
            color: #333;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

        th {
            background-color: #f2f2f2;
        }

        #logarea {
            height: 200px;
            overflow: auto;
            background: #111;
            color: #0f0;
            padding: 10px;
            font-family: monospace;
            border-radius: 4px;
        }

        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }

            button:disabled {
                background: #ccc;
                cursor: not-allowed;
            }

            button:hover:not(:disabled) {
                background: #45a049;
            }

        input[type="text"] {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 70%;
            margin: 5px 0;
        }

        .status {
            padding: 5px 10px;
            border-radius: 4px;
            display: inline-block;
            margin: 5px;
        }

        .status-running {
            background: #e6f7ff;
            color: #0070c0;
        }

        .status-finished {
            background: #e6ffed;
            color: #007000;
        }

        .status-error {
            background: #fff2f0;
            color: #c00;
        }

        .app-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .progress-container {
            width: 100%;
            background-color: #f1f1f1;
            border-radius: 4px;
            margin: 10px 0;
        }

        .progress-bar {
            height: 10px;
            background-color: #4CAF50;
            border-radius: 4px;
            width: 0%;
            transition: width 0.3s;
        }

        .sdk-result {
            margin: 10px 0;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .sdk-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }

        .sdk-details {
            margin-top: 10px;
            display: none;
        }

            .sdk-details.show {
                display: block;
            }

        .finding {
            margin: 5px 0;
            padding: 5px;
            background: #f9f9f9;
            border-radius: 4px;
        }

        .finding-code {
            font-family: monospace;
            background: #eee;
            padding: 3px;
            border-radius: 3px;
        }

        .risk-high {
            color: #c00;
            font-weight: bold;
        }

        .risk-medium {
            color: #c90;
        }

        .risk-low {
            color: #090;
        }

        .tab {
            overflow: hidden;
            border: 1px solid #ccc;
            background-color: #f1f1f1;
            border-radius: 4px;
        }

            .tab button {
                background-color: inherit;
                float: left;
                border: none;
                outline: none;
                cursor: pointer;
                padding: 10px 16px;
                transition: 0.3s;
                color: #333;
            }

                .tab button:hover {
                    background-color: #ddd;
                }

                .tab button.active {
                    background-color: #4CAF50;
                    color: white;
                }

        .tabcontent {
            display: none;
            padding: 6px 12px;
            border: 1px solid #ccc;
            border-top: none;
            border-radius: 0 0 4px 4px;
        }

        .file-browser {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #ddd;
            padding: 10px;
            margin: 10px 0;
        }

        .file-item {
            padding: 5px;
            cursor: pointer;
            border-bottom: 1px solid #eee;
        }

            .file-item:hover {
                background-color: #f0f0f0;
            }

        .folder-icon:before {
            content: "üìÅ ";
        }

        .file-icon:before {
            content: "üìÑ ";
        }

        .current-path {
            margin: 10px 0;
            padding: 5px;
            background: #f0f0f0;
            border-radius: 4px;
            font-family: monospace;
        }

        .selected-folder {
            background-color: #e6f7ff;
            border: 2px solid #0070c0;
        }

        .manual-path-input {
            margin: 10px 0;
            padding: 8px;
            width: 70%;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .live-results {
            max-height: 500px;
            overflow-y: auto;
            border: 1px solid #ddd;
            padding: 10px;
            margin: 10px 0;
        }

        .current-file {
            margin: 5px 0;
            padding: 3px;
            background: #f0f0f0;
            border-radius: 3px;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>PICO APK Scanner - Smart Real-Time Analysis</h1>

    <div class="tab">
        <button class="tablinks active" onclick="openTab(event, 'FullProcessTab')">Full Process</button>
        <button class="tablinks" onclick="openTab(event, 'DirectScanTab')">Direct Scan</button>
    </div>

    <!-- Full Process Tab -->
    <div id="FullProcessTab" class="tabcontent" style="display: block;">
        <div class="panel">
            <h3>Device Status</h3>
            <div id="device">Detecting devices...</div>
            <button onclick="refreshDevices()">Refresh Devices</button>
        </div>

        <div class="panel">
            <h3>Installed Apps</h3>
            <div id="appslist">Select a device to view apps</div>
        </div>

        <div class="panel">
            <h3>APK Paths</h3>
            <div id="apkslist">Select an app to view APK files</div>
        </div>

        <div class="panel">
            <h3>Actions</h3>
            <label>APK Destination: <input id="destpath" placeholder="C:\Users\user\Music\Call\app.apk"></label><br>
            <button id="pullbtn" disabled>Pull APK</button>
            <button id="decompilebtn" disabled>Decompile</button>
            <button id="scanbtn" disabled>Scan</button>
            <button id="openfolderbtn" disabled>Open Folder</button>

            <div class="progress-container" id="progressContainer" style="display: none;">
                <div class="progress-bar" id="progressBar"></div>
                <div id="progressText" style="text-align: center; margin-top: 5px;">0%</div>
                <div id="currentFile" class="current-file">Current file: None</div>
            </div>
        </div>
    </div>

    <!-- Direct Scan Tab -->
    <div id="DirectScanTab" class="tabcontent">
        <div class="panel">
            <h3>Direct Scan</h3>
            <p>Select a decompiled APK folder to scan directly:</p>

            <div class="current-path" id="currentPath">Current path: .</div>

            <div class="file-browser" id="fileBrowser">
                <div id="browserContent">Loading...</div>
            </div>

            <div id="selectedFolderInfo" style="display: none; margin: 10px 0; padding: 10px; background: #e6f7ff; border-radius: 4px;">
                <strong>Selected folder:</strong> <span id="selectedFolderPath"></span>
            </div>

            <h4>Or enter path manually:</h4>
            <input type="text" id="manualPathInput" class="manual-path-input" placeholder="C:\path\to\call_decompiled">
            <button onclick="selectManualPath()">Select Manual Path</button>

            <br><br>
            <button id="scanDirectBtn" disabled>Start Scan</button>
            <button id="refreshBrowserBtn" onclick="refreshBrowser()">Refresh</button>
            <button id="browseHomeBtn" onclick="loadFileBrowser('.')">Home Directory</button>

            <div class="progress-container" id="directProgressContainer" style="display: none;">
                <div class="progress-bar" id="directProgressBar"></div>
                <div id="directProgressText" style="text-align: center; margin-top: 5px;">0%</div>
                <div id="directCurrentFile" class="current-file">Current file: None</div>
            </div>
        </div>
    </div>

    <div class="panel">
        <h3>Live Scan Progress</h3>
        <div id="liveResults" class="live-results">
            No scan in progress. Results will appear here in real-time.
        </div>
    </div>

    <div class="panel">
        <h3>Logs</h3>
        <div id="logarea"></div>
    </div>

    <div class="panel">
        <h3>Scan Results <span id="resultsCount"></span></h3>
        <div id="results">No results yet</div>
    </div>

    <script>
        let selectedPackage = null;
        let selectedApkPath = null;
        let lastDecompileDir = null;
        let currentResults = [];
        let expandedSDKs = {};
        let currentBrowserPath = '.';
        let selectedScanFolder = null;
        let currentDevice = null;

        function api(url, options) {
            return fetch(url, options).then(r => r.json());
        }

        function log(message) {
            const logArea = document.getElementById('logarea');
            logArea.innerHTML += `[${new Date().toLocaleTimeString()}] ${message}\n`;
            logArea.scrollTop = logArea.scrollHeight;
        }

        function showProgress(show, isDirect = false) {
            const container = isDirect ? 'directProgressContainer' : 'progressContainer';
            document.getElementById(container).style.display = show ? 'block' : 'none';
        }

        function updateProgress(percent, isDirect = false) {
            const bar = isDirect ? 'directProgressBar' : 'progressBar';
            const text = isDirect ? 'directProgressText' : 'progressText';
            document.getElementById(bar).style.width = percent + '%';
            document.getElementById(text).innerText = Math.round(percent) + '%';
        }

        function updateCurrentFile(filename, isDirect = false) {
            const element = isDirect ? 'directCurrentFile' : 'currentFile';
            document.getElementById(element).innerText = `Current file: ${filename || 'None'}`;
        }

        function openTab(evt, tabName) {
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            tablinks = document.getElementsByClassName("tablinks");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            document.getElementById(tabName).style.display = "block";
            evt.currentTarget.className += " active";

            // Load file browser when Direct Scan tab is opened
            if (tabName === 'DirectScanTab') {
                loadFileBrowser('.');
            } else if (tabName === 'FullProcessTab') {
                refreshDevices();
            }
        }

        function refreshDevices() {
            api('/device').then(r => {
                const deviceEl = document.getElementById('device');

                if (r.device && r.device.length) {
                    let html = '';
                    r.device.forEach(device => {
                        html += `<span class="status status-finished">${device}</span> `;
                    });
                    deviceEl.innerHTML = html;
                    currentDevice = r.device[0];
                    loadApps();
                } else {
                    deviceEl.innerHTML = '<span class="status status-error">No devices found</span>';
                    currentDevice = null;
                }
            });
        }

        function loadApps() {
            if (!currentDevice) return;

            const appsList = document.getElementById('appslist');
            appsList.innerHTML = "Loading apps...";

            api('/list_apps').then(r => {
                if (r.error) {
                    appsList.innerHTML = `<span class="status status-error">${r.error}</span>`;
                    return;
                }

                let html = '<div class="app-list"><table><tr><th>#</th><th>App</th><th>Package</th><th></th></tr>';
                r.apps.forEach(app => {
                    html += `<tr>
                                <td>${app.index}</td>
                                <td>${app.short}</td>
                                <td>${app.package}</td>
                                <td><button onclick="selectApp('${app.package}')">Select</button></td>
                            </tr>`;
                });
                html += '</table></div>';
                appsList.innerHTML = html;
            });
        }

        function loadFileBrowser(path) {
            const browserContent = document.getElementById('browserContent');
            browserContent.innerHTML = "Loading...";

            api('/browse_folder?path=' + encodeURIComponent(path)).then(r => {
                if (r.error) {
                    browserContent.innerHTML = `<span class="status status-error">Error: ${r.error}</span>`;
                    return;
                }

                currentBrowserPath = r.path;
                document.getElementById('currentPath').innerText = `Current path: ${r.path}`;

                let html = '';

                // Add parent directory link if not at root
                if (r.path !== '.' && r.path !== '/') {
                    const parentPath = os.path.dirname(r.path);
                    html += `<div class="file-item" onclick="loadFileBrowser('${parentPath}')">
                                <span class="folder-icon"></span>..
                            </div>`;
                }

                // Add directories first
                r.items.filter(item => item.is_dir).forEach(item => {
                    html += `<div class="file-item" onclick="selectFolder('${item.path}')">
                                <span class="folder-icon"></span>${item.name}
                            </div>`;
                });

                // Then add files (but we're only interested in directories for scanning)
                r.items.filter(item => !item.is_dir).forEach(item => {
                    html += `<div class="file-item">
                                <span class="file-icon"></span>${item.name}
                            </div>`;
                });

                if (r.items.length === 0) {
                    html = '<div class="file-item">No items found in this directory</div>';
                }

                browserContent.innerHTML = html;
            }).catch(err => {
                browserContent.innerHTML = `<span class="status status-error">Error loading directory: ${err}</span>`;
            });
        }

        function refreshBrowser() {
            loadFileBrowser(currentBrowserPath);
        }

        function selectFolder(path) {
            selectedScanFolder = path;

            // Update UI to show selected folder
            document.getElementById('selectedFolderInfo').style.display = 'block';
            document.getElementById('selectedFolderPath').textContent = path;

            // Enable scan button
            document.getElementById('scanDirectBtn').disabled = false;

            log(`Selected folder: ${path}`);

            // Highlight the selected folder
            const items = document.querySelectorAll('.file-item');
            items.forEach(item => {
                item.classList.remove('selected-folder');
                if (item.textContent.includes(path.split('/').pop().split('\\').pop())) {
                    item.classList.add('selected-folder');
                }
            });
        }

        function selectManualPath() {
            const manualPath = document.getElementById('manualPathInput').value;
            if (!manualPath) {
                alert("Please enter a folder path");
                return;
            }

            // Test if the path exists by trying to browse it
            api('/browse_folder?path=' + encodeURIComponent(manualPath)).then(r => {
                if (r.error) {
                    log(`Error: ${r.error}`);
                    alert(`Invalid path: ${r.error}`);
                    return;
                }

                selectedScanFolder = manualPath;

                // Update UI to show selected folder
                document.getElementById('selectedFolderInfo').style.display = 'block';
                document.getElementById('selectedFolderPath').textContent = manualPath;

                // Enable scan button
                document.getElementById('scanDirectBtn').disabled = false;

                log(`Selected folder: ${manualPath}`);
            }).catch(err => {
                log(`Error: ${err}`);
                alert(`Invalid path: ${err}`);
            });
        }

        function selectApp(pkg) {
            selectedPackage = pkg;
            log(`Selected app: ${pkg}`);

            const apksList = document.getElementById('apkslist');
            apksList.innerHTML = "Loading APK paths...";

            api('/apk_paths?package=' + encodeURIComponent(pkg)).then(r => {
                if (r.paths && r.paths.length) {
                    let html = '<table><tr><th>Path</th><th></th></tr>';
                    r.paths.forEach((path, i) => {
                        html += `<tr>
                                    <td>${path}</td>
                                    <td><button onclick="selectApk('${path}')">Select</button></td>
                                </tr>`;
                    });
                    html += '</table>';
                    apksList.innerHTML = html;
                } else {
                    apksList.innerHTML = "No APK paths found";
                }
            });
        }

        function selectApk(path) {
            selectedApkPath = path;
            document.getElementById('pullbtn').disabled = false;
            log(`Selected APK: ${path}`);
        }

        document.getElementById('pullbtn').onclick = function () {
            const dest = document.getElementById('destpath').value;
            if (!dest) {
                alert("Please enter a destination path");
                return;
            }

            showProgress(true);
            updateProgress(10);
            log(`Pulling APK to ${dest}`);

            api('/start_pull', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    package: selectedPackage,
                    apk_path: selectedApkPath,
                    dest_path: dest
                })
            }).then(r => {
                pollTask(r.task_id, data => {
                    if (data.meta && data.meta.apk) {
                        document.getElementById('destpath').value = data.meta.apk;
                        document.getElementById('decompilebtn').disabled = false;
                        updateProgress(50);
                    }
                    showProgress(false);
                });
            });
        };

        document.getElementById('decompilebtn').onclick = function () {
            const apkPath = document.getElementById('destpath').value;
            if (!apkPath) {
                alert("No APK selected");
                return;
            }

            showProgress(true);
            updateProgress(60);
            log(`Decompiling ${apkPath}`);

            api('/start_decompile', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ apk_path: apkPath })
            }).then(r => {
                pollTask(r.task_id, data => {
                    if (data.meta && data.meta.decompile_dir) {
                        lastDecompileDir = data.meta.decompile_dir;
                        document.getElementById('scanbtn').disabled = false;
                        document.getElementById('openfolderbtn').disabled = false;
                        updateProgress(80);
                    }
                    showProgress(false);
                });
            });
        };

        document.getElementById('scanbtn').onclick = function () {
            if (!lastDecompileDir) {
                alert("No decompiled directory available");
                return;
            }

            showProgress(true);
            updateProgress(5);
            log(`Starting scan of ${lastDecompileDir}`);

            api('/start_scan', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ decompile_dir: lastDecompileDir })
            }).then(r => {
                pollTask(r.task_id, data => {
                    if (data.meta) {
                        if (data.meta.progress) {
                            updateProgress(data.meta.progress);
                        }

                        if (data.meta.partial_results) {
                            renderResults(data.meta.partial_results);
                            updateLiveResults(data.meta.partial_results);
                        }

                        if (data.meta.current_file) {
                            updateCurrentFile(data.meta.current_file);
                        }

                        if (data.meta.results) {
                            currentResults = data.meta.results;
                            renderResults(currentResults);
                            updateProgress(100);
                            setTimeout(() => showProgress(false), 1000);
                        }
                    }
                });
            });
        };

        document.getElementById('scanDirectBtn').onclick = function () {
            if (!selectedScanFolder) {
                alert("No folder selected for scanning");
                return;
            }

            showProgress(true, true);
            updateProgress(5, true);
            log(`Starting direct scan of ${selectedScanFolder}`);

            api('/start_scan', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ decompile_dir: selectedScanFolder })
            }).then(r => {
                pollTask(r.task_id, data => {
                    if (data.meta) {
                        if (data.meta.progress) {
                            updateProgress(data.meta.progress, true);
                        }

                        if (data.meta.partial_results) {
                            renderResults(data.meta.partial_results);
                            updateLiveResults(data.meta.partial_results);
                        }

                        if (data.meta.current_file) {
                            updateCurrentFile(data.meta.current_file, true);
                        }

                        if (data.meta.results) {
                            currentResults = data.meta.results;
                            renderResults(currentResults);
                            updateProgress(100, true);
                            setTimeout(() => showProgress(false, true), 1000);
                        }
                    }
                }, true);
            });
        };

        document.getElementById('openfolderbtn').onclick = function () {
            if (!lastDecompileDir) {
                alert("No folder to open");
                return;
            }

            api('/open_folder', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ path: lastDecompileDir })
            }).then(r => {
                if (r.error) {
                    log(`Error: ${r.error}`);
                } else {
                    log("Folder opened");
                }
            });
        };

        function pollTask(taskId, callback, isDirect = false) {
            const interval = setInterval(() => {
                api('/task_status/' + taskId).then(data => {
                    if (data.logs) {
                        data.logs.forEach(logEntry => {
                            if (!logEntry.includes('PICO APK Scanner')) {
                                log(logEntry);
                            }
                        });
                    }

                    if (data.meta) {
                        if (data.meta.progress) {
                            updateProgress(data.meta.progress, isDirect);
                        }

                        if (data.meta.partial_results) {
                            renderResults(data.meta.partial_results);
                            updateLiveResults(data.meta.partial_results);
                        }

                        if (data.meta.current_file) {
                            updateCurrentFile(data.meta.current_file, isDirect);
                        }
                    }

                    if (['finished', 'error'].includes(data.status)) {
                        clearInterval(interval);
                        callback(data);
                    }
                });
            }, 1000);
        }

        function updateLiveResults(results) {
            if (!results || results.length === 0) {
                document.getElementById('liveResults').innerHTML = "No results yet";
                return;
            }

            let html = '<h4>Live Scan Results</h4>';
            let totalFindings = 0;
            let totalPVPs = 0;

            results.forEach(r => {
                const findings = r.found_inits.length + r.found_privacy_apis.length;
                const pvps = r.pvp_triggered.length;

                totalFindings += findings;
                totalPVPs += pvps;

                html += `
                    <div class="sdk-result">
                        <div class="sdk-header">
                            <strong>${r.sdk}</strong>
                            <span>${findings} findings, ${pvps} PVPs</span>
                        </div>
                    </div>
                    `;
            });

            html += `<div class="status">Total: ${totalFindings} findings, ${totalPVPs} PVPs</div>`;
            document.getElementById('liveResults').innerHTML = html;
        }

        function toggleSDK(sdk) {
            expandedSDKs[sdk] = !expandedSDKs[sdk];
            renderResults(currentResults);
        }

        function renderResults(results) {
            if (!results || results.length === 0) {
                document.getElementById('results').innerHTML = "No results found";
                document.getElementById('resultsCount').innerText = '';
                return;
            }

            document.getElementById('resultsCount').innerText = `(${results.length} SDKs analyzed)`;

            let html = '';
            let pvpCount = 0;
            let findingCount = 0;

            results.forEach(r => {
                const findings = r.found_inits.length + r.found_privacy_apis.length;
                const missing = r.missing_privacy_apis.length;
                const pvps = r.pvp_triggered.length;

                pvpCount += pvps;
                findingCount += findings;

                const riskLevel = pvps > 0 ? 'high' : (missing > 0 ? 'medium' : 'low');

                html += `
                    <div class="sdk-result">
                        <div class="sdk-header" onclick="toggleSDK('${r.sdk}')">
                            <div>
                                <strong>${r.sdk}</strong>
                                <span class="risk-${riskLevel}">(${r.laws})</span>
                            </div>
                            <div>
                                <span class="status">${findings} findings, ${missing} missing, ${pvps} PVPs</span>
                                <button>${expandedSDKs[r.sdk] ? 'Collapse' : 'Expand'}</button>
                            </div>
                        </div>
                        <div class="sdk-details ${expandedSDKs[r.sdk] ? 'show' : ''}">
                            <h4>Initialization Patterns Found:</h4>
                            ${r.found_inits.length > 0 ?
                        r.found_inits.map(init => `
                                    <div class="finding">
                                        <strong>${init.path}</strong> (Line ${init.line})<br>
                                        <div class="finding-code">${init.code}</div>
                                    </div>
                                `).join('') :
                        '<p>No initialization patterns found</p>'
                    }

                            <h4>Privacy APIs Found:</h4>
                            ${r.found_privacy_apis.length > 0 ?
                        r.found_privacy_apis.map(api => `
                                    <div class="finding">
                                        <strong>${api.law}:</strong> ${api.api} in ${api.path} (Line ${api.line})<br>
                                        <div class="finding-code">${api.code}</div>
                                    </div>
                                `).join('') :
                        '<p>No privacy APIs found</p>'
                    }

                            <h4>Missing Privacy APIs:</h4>
                            ${r.missing_privacy_apis.length > 0 ?
                        `<ul>${r.missing_privacy_apis.map(m => `<li>${m}</li>`).join('')}</ul>` :
                        '<p>No missing privacy APIs</p>'
                    }

                            <h4>PVP Triggers:</h4>
                            ${r.pvp_triggered.length > 0 ?
                        `<ul>${r.pvp_triggered.map(pvp => `<li class="risk-high">${pvp}</li>`).join('')}</ul>` :
                        '<p>No PVP triggers</p>'
                    }
                        </div>
                    </div>
                    `;
            });

            // Add summary at the top
            const summaryHtml = `
                    <div class="sdk-result" style="background-color: #f8f8f8;">
                        <h3>Scan Summary</h3>
                        <p>Total SDKs analyzed: ${results.length}</p>
                        <p>Total findings: ${findingCount}</p>
                        <p class="${pvpCount > 0 ? 'risk-high' : 'risk-low'}">Total PVP triggers: ${pvpCount}</p>
                    </div>
                `;

            document.getElementById('results').innerHTML = summaryHtml + html;
        }

        // Simple path utilities since we can't import Node.js path module in browser
        const os = {
            path: {
                dirname: function (path) {
                    return path.replace(/\\/g, '/').replace(/\/[^\/]*$/, '') || '.';
                }
            }
        };

        // Initialize
        refreshDevices();
    </script>
</body>
</html>
